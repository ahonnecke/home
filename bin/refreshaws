#!/usr/bin/env bash
set -e

NAME2IPBIN=awsname2ip
DOMAIN="pixelstub"
INSTANCE="production-20170403"

if [ -f $NAME2IPBIN ]; then
    echo "Binary exists in the local env."
else
    NAME2IPBIN=./awsname2ip
fi

if [[ $EUID -eq 0 ]]; then
    #Remove all the old instances of the webheads from hosts
    sudo sed -i'' '/www-[0-9].pixelstub.com/d' /etc/hosts
fi

IPS=$($NAME2IPBIN $INSTANCE)

WEBHEAD=1;
for IP in $IPS
do
    echo "$IP www-$WEBHEAD.pixelstub.com"

    if [[ $EUID -eq 0 ]]; then
        echo "$IP www-$WEBHEAD.pixelstub.com" >> /etc/hosts
    fi
    ((WEBHEAD++))
done;

exit 0
